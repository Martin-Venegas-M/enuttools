% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/estimar_srvyr.R
\name{estimar_srvyr}
\alias{estimar_srvyr}
\title{Estimate totals, means, and proportions with \code{srvyr} objects}
\usage{
estimar_srvyr(
  svy.obj,
  type.est = c("total", "mean", "total.mean", "prop", "total.prop"),
  est.var,
  subpop = TRUE,
  group.vars = NULL,
  use.labels = TRUE,
  est.var.label = NULL,
  na.rm.est.var = TRUE,
  na.rm.group.vars = TRUE,
  format = FALSE,
  format.args = NULL,
  ...
)
}
\arguments{
\item{svy.obj}{A \code{srvyr::tbl_svy} object.}

\item{type.est}{Character string indicating the type of estimate to compute.
Must be one of \code{c("total", "mean", "total.mean", "prop", "total.prop")}.}

\item{est.var}{Variable to estimate (tidy-evaluation style). For \code{"prop"} and
\code{"total.prop"}, this should be a categorical (or dichotomous) variable.}

\item{subpop}{Logical expression (tidy-evaluation style) defining the
subpopulation. Defaults to \code{TRUE} (entire sample).}

\item{group.vars}{Grouping variables (tidy-select syntax), e.g.
\code{c(var1, var2)}. Defaults to \code{NULL} (no domains).}

\item{use.labels}{Logical. If \code{TRUE}, converts grouping variables (and
\code{est.var} for proportion estimates) to labels using
\code{sjlabelled::to_label()}.}

\item{est.var.label}{A string with the label of the estimation variable.}

\item{na.rm.est.var}{Logical. If \code{TRUE}, removes NA values from estimation variable}

\item{na.rm.group.vars}{Lofical. If \code{TRUE}, removas NA values from grouping variables}

\item{format}{Logical. If \code{TRUE}, applies final formatting to the output
table via a helper function \code{format_tab()}.}

\item{format.args}{Optional named list of arguments passed to
\code{format_tab()} through \code{rlang::call2()} (e.g.
\code{list(digits = 1)}). Ignored if \code{format = FALSE}.}

\item{...}{Additional arguments passed to the underlying \pkg{srvyr} functions,
typically \code{survey_total()} or \code{survey_mean()}
(e.g., \code{vartype = "se"}).}
}
\value{
A \code{tibble} with:
\itemize{
  \item \code{variable}: name of \code{est.var}.
  \item Domain columns (if \code{group.vars} not \code{NULL}).
  \item For \code{"total"}: \code{total}, \code{total_se}.
  \item For \code{"mean"}: \code{media}, \code{media_se}.
  \item For \code{"prop"}: \code{val} (level of \code{est.var}),
        \code{prop}, \code{prop_se}.
  \item For \code{"total.mean"}: \code{total}, \code{total_se},
        \code{media}, \code{media_se}.
  \item For \code{"total.prop"}: \code{val}, \code{total}, \code{total_se},
        \code{prop}, \code{prop_se}.
}
}
\description{
Depending on the value of \code{type.est}, the function computes:
\itemize{
  \item \code{"total"}: total (and its standard error) of \code{est.var}.
  \item \code{"mean"}: mean (and its standard error) of \code{est.var}.
  \item \code{"prop"}: proportion (and its standard error) for each level of \code{est.var}
        (for categorical or dichotomous variables).
  \item \code{"total.mean"}: both total and mean for \code{est.var}.
  \item \code{"total.prop"}: both total and proportion for each level of \code{est.var}.
}
}
\details{
Helper function to compute estimates from a \code{srvyr::tbl_svy} object using
tidy evaluation. Supports totals, means, proportions (and combinations),
optionally by domains (grouping variables) and/or for a defined subpopulation.


The function performs the following steps:
\enumerate{
  \item Filters the subpopulation (\code{srvyr::filter({{ subpop }})}).
  \item Optionally converts grouping variables and, for proportions,
        \code{est.var} to labels.
  \item Groups by \code{group.vars}, if provided.
  \item Computes the requested estimate(s) using \pkg{srvyr}.
  \item Adds a \code{variable} column with the name of \code{est.var}
        and reorders columns to the front.
  \item Optionally formats the output table with \code{format_tab()}.
}
}
\examples{
\dontrun{

pmrural_srvy <- list(
  cut = pmrural \%>\% fast_survey_design(weights = "fe_cut", pop = informante_kish == 1),
  ch = pmrural \%>\% fast_survey_design(weights = "fe_ch")
)


# 1) Mean of t_tcnr by age group
pmrural_srvy$cut \%>\%
  estimar_srvyr(
    type.est = "mean",
    est.var = t_tcnr,
    group.vars = tr_edad
  )

# 2) Mean of t_tcnr among caregivers only
pmrural_srvy$cut \%>\%
  estimar_srvyr(
    type.est = "mean",
    est.var = t_tcnr,
    group.vars = tr_edad,
    subpop = cui_psdf_o_resp_nna == 1
  )

# 3) Mean of t_tcnr by caregiver status and age group
pmrural_srvy$cut \%>\%
  estimar_srvyr(
    type.est = "mean",
    est.var = t_tcnr,
    group.vars = c(cui_psdf_o_resp_nna, tr_edad)
  )

# 4) Totals and proportions of rph5 among caregivers
pmrural_srvy$ch \%>\%
  estimar_srvyr(
    type.est = "total.prop",
    est.var = rph5,
    subpop = cui_psdf_o_resp_nna == 1
  )

# 5) Totals and proportions of rph5 by caregiver status
pmrural_srvy$ch \%>\%
  estimar_srvyr(
    type.est = "total.prop",
    est.var = rph5,
    group.vars = cui_psdf_o_resp_nna
  )
}

}
\seealso{
\code{\link[srvyr]{survey_mean}}, \code{\link[srvyr]{survey_total}},
  \code{format_tab()}.
}
