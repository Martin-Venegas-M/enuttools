% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/valseg_check.R
\name{valseg_check}
\alias{valseg_check}
\title{Check Activated Second-Level Validations}
\usage{
valseg_check(
  data,
  data_val,
  id_reglas,
  exp_regla,
  vars_regla,
  desc_regla,
  var_constant,
  regla_to_check,
  id,
  level = "person",
  id_hog
)
}
\arguments{
\item{data}{\code{data.frame}. Original dataset containing the variables of interest.}

\item{data_val}{\code{data.frame}. Dataset containing validation variables with
indicators (0/1) for rule activation, typically the output from the \code{valprimer()} function.}

\item{id_reglas}{\code{character}. Vector with all rule identifiers.}

\item{exp_regla}{\code{character}. Vector with all logical expressions for the rules.}

\item{vars_regla}{\code{character}. Vector with variables involved in each rule
(comma-separated).}

\item{desc_regla}{\code{character}. Vector with rule descriptions.}

\item{var_constant}{\code{character}. Vector with constant variables to be included
in the review (e.g., sex, age).}

\item{regla_to_check}{\code{character}. Identifier of the rule to be reviewed.}

\item{id}{\code{character}. Name of the unique survey identifier.}

\item{level}{\code{character}. Desired unit of analysis for the review.
Can be a \code{person} or a \code{household}.}

\item{id_hog}{\code{character}. Name of the household identifier.}
}
\value{
A \code{data.frame} containing:
\itemize{
  \item \code{regla}: Identifier of the reviewed rule.
  \item \code{expr}: Logical expression of the rule.
  \item \code{desc}: Rule description.
  \item Constant variables and variables involved in the rule.
  \item The identifiers of the cases that triggered the rule.
}
}
\description{
Creates a \code{data.frame} with the information required to review
cases that triggered a second-level validation in the survey data.
}
\details{
The function filters only those cases that actually triggered the rule
(value 1 in the corresponding variable in \code{data_val}).

The function assumes the existence of a metadata source containing
information about all validation rules, their logical expressions and the
variables used in the expression.
}
\examples{
library(dplyr)

# Example of metadata
metadata <- tibble(
  id_regla = c("rule1", "rule2"),
  exp_regla = c("age < 18 & working == 1", "age < 5 & educ == 3"),
  vars_regla = c("age, working", "age, educ"),
  desc_regla = c("Minors should not be working", "Infants can't have tertiary education")
)

# Example data
data <- tibble(
  id = 1:5,
  age = c(6, 20, 17, 22, 2),
  working = c(1, 1, 0, 1, 0),
  educ = c(1, 3, 2, 3, 3),
  sex = c("M", "F", "M", "F", "M")
)

# Example validation output (from valseg)
data_val <- tibble(
  id = 1:5,
  rule1 = c(1, 0, 0, 0, 0),
  rule2 = c(0, 0, 0, 0, 1)
)

valseg_check(
  data = data,
  data_val = data_val,
  id_reglas = metadata$id_regla,
  exp_regla = metadata$exp_regla,
  vars_regla = metadata$vars_regla,
  desc_regla = metadata$desc_regla,
  var_constant = "sex",
  regla_to_check = "rule1",
  id = "id"
)

}
